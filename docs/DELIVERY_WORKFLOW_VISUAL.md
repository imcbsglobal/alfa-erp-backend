# Delivery Workflow Visual Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INVOICE DELIVERY WORKFLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   PACKED     â”‚
                            â”‚   INVOICE    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Dispatch Page
                                   â”‚ (Biller initiates)
                                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  SELECT DELIVERY TYPE  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚                  â”‚
                â–¼                  â–¼                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ COUNTER PICKUP â”‚  â”‚   COURIER    â”‚  â”‚   COMPANY    â”‚
       â”‚    (DIRECT)    â”‚  â”‚   DELIVERY   â”‚  â”‚   DELIVERY   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                  â”‚                  â”‚
                â”‚                  â”‚                  â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                  â”‚
     â”‚                    â”‚       â”‚                  â”‚
     â–¼                    â–¼       â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                  â”‚
â”‚ DIRECT  â”‚       â”‚  DIRECT  â”‚   â”‚                  â”‚
â”‚ PATIENT â”‚       â”‚ COMPANY  â”‚   â”‚                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚                  â”‚
     â”‚                 â”‚          â”‚                  â”‚
     â–¼                 â–¼          â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POPUP FORM  â”‚  â”‚  POPUP FORM  â”‚  â”‚  SELECT COURIER  â”‚  â”‚  ENTER STAFF     â”‚
â”‚             â”‚  â”‚              â”‚  â”‚                  â”‚  â”‚  EMAIL & NAME    â”‚
â”‚ â€¢ Username  â”‚  â”‚ â€¢ Username   â”‚  â”‚  â€¢ Active        â”‚  â”‚                  â”‚
â”‚ â€¢ Name      â”‚  â”‚ â€¢ Name       â”‚  â”‚    Couriers      â”‚  â”‚  â€¢ user_email    â”‚
â”‚ â€¢ Phone     â”‚  â”‚ â€¢ Phone      â”‚  â”‚    Dropdown      â”‚  â”‚  â€¢ user_name     â”‚
â”‚             â”‚  â”‚ â€¢ Company    â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚             â”‚  â”‚   Name       â”‚  â”‚  â€¢ Search        â”‚  â”‚                  â”‚
â”‚             â”‚  â”‚ â€¢ Company ID â”‚  â”‚                  â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                 â”‚                   â”‚                     â”‚
      â”‚                 â”‚                   â”‚                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                     â”‚
               â”‚                            â”‚                     â”‚
               â–¼                            â–¼                     â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   DELIVERED   â”‚          â”‚  COURIER CONSIDER â”‚   â”‚  COMPANY CONSIDERâ”‚
       â”‚   (INSTANT)   â”‚          â”‚       LIST        â”‚   â”‚       LIST       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                   â”‚   â”‚                  â”‚
               â”‚                  â”‚ Status:           â”‚   â”‚ Status:          â”‚
               â”‚                  â”‚ TO_CONSIDER       â”‚   â”‚ TO_CONSIDER      â”‚
               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                           â”‚                       â”‚
               â”‚                           â”‚                       â”‚
               â”‚                           â–¼                       â–¼
               â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                  â”‚  UPLOAD COURIER  â”‚   â”‚ STAFF ACCEPTS &  â”‚
               â”‚                  â”‚      SLIP        â”‚   â”‚ COMPLETES        â”‚
               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                           â”‚                       â”‚
               â”‚                           â–¼                       â–¼
               â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                  â”‚   IN_TRANSIT     â”‚   â”‚   IN_TRANSIT     â”‚
               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                           â”‚                       â”‚
               â”‚                           â–¼                       â–¼
               â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                  â”‚    DELIVERED     â”‚   â”‚    DELIVERED     â”‚
               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                           â”‚                       â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ DELIVERY HISTORYâ”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Flow Explanations

### ğŸŸ¢ **Counter Pickup Flow (Instant Completion)**

```
PACKED â†’ Dispatch Page â†’ Counter Pickup Button
   â†“
Select Sub-Type:
   â”œâ”€ Direct Patient â†’ Enter: Username, Name, Phone
   â””â”€ Direct Company â†’ Enter: Username, Name, Phone, Company Name, Company ID
   â†“
Submit â†’ Validate (10-digit phone, all required fields)
   â†“
Backend:
   â”œâ”€ Create DeliverySession (delivery_type='DIRECT')
   â”œâ”€ Set counter_sub_mode ('patient' or 'company')
   â”œâ”€ Set start_time = now()
   â”œâ”€ Set end_time = now()
   â”œâ”€ Set delivery_status = 'DELIVERED'
   â””â”€ Update Invoice status = 'DELIVERED'
   â†“
âœ… COMPLETED (No further steps)
```

---

### ğŸŸ  **Courier Delivery Flow (Multi-Step)**

```
PACKED â†’ Dispatch Page â†’ Courier Delivery Button
   â†“
Select Courier:
   â”œâ”€ Load active couriers
   â”œâ”€ Search/filter by name or code
   â””â”€ Select courier from dropdown
   â†“
Submit
   â†“
Backend:
   â”œâ”€ Create DeliverySession (delivery_type='COURIER')
   â”œâ”€ Set delivery_status = 'TO_CONSIDER'
   â”œâ”€ Set assigned_to = current_user
   â”œâ”€ Set courier_name from selected courier
   â””â”€ Keep Invoice status = 'PACKED'
   â†“
Appears in: /delivery/courier-deliveries
   â†“
Courier Consider List Page:
   â”œâ”€ View all TO_CONSIDER courier deliveries
   â”œâ”€ Upload courier slip (image/PDF)
   â””â”€ Submit slip upload
   â†“
Backend (on slip upload):
   â”œâ”€ Update delivery_status = 'IN_TRANSIT'
   â”œâ”€ Save courier_slip file
   â”œâ”€ Set end_time = now()
   â”œâ”€ Set delivery_status = 'DELIVERED'
   â””â”€ Update Invoice status = 'DELIVERED'
   â†“
âœ… COMPLETED
```

---

### ğŸ”µ **Company Delivery Flow (Multi-Step)**

```
PACKED â†’ Dispatch Page â†’ Company Delivery Button
   â†“
Enter Staff Details:
   â”œâ”€ Staff Email (required)
   â””â”€ Staff Name (required)
   â†“
Submit
   â†“
Backend:
   â”œâ”€ Validate user exists by email
   â”œâ”€ Create DeliverySession (delivery_type='INTERNAL')
   â”œâ”€ Set delivery_status = 'TO_CONSIDER'
   â”œâ”€ Set assigned_to = current_user
   â””â”€ Keep Invoice status = 'PACKED'
   â†“
Appears in: /delivery/company-deliveries
   â†“
Company Consider List Page:
   â”œâ”€ View all TO_CONSIDER company deliveries
   â”œâ”€ See assigned staff member
   â””â”€ Wait for staff to complete
   â†“
Staff Dashboard (/ops/delivery/my-deliveries):
   â”œâ”€ Staff member sees assigned deliveries
   â”œâ”€ Accept delivery
   â””â”€ Mark as complete (with optional location data)
   â†“
Backend (on completion):
   â”œâ”€ Update delivery_status = 'IN_TRANSIT' (when accepted)
   â”œâ”€ Set start_time = now()
   â”œâ”€ Update Invoice status = 'DISPATCHED'
   â”œâ”€ On final completion:
   â”‚   â”œâ”€ Set end_time = now()
   â”‚   â”œâ”€ Set delivery_status = 'DELIVERED'
   â”‚   â”œâ”€ Set delivered_by = staff_user
   â”‚   â””â”€ Update Invoice status = 'DELIVERED'
   â””â”€ Save delivery location (optional)
   â†“
âœ… COMPLETED
```

---

## Page Navigation Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND PAGES                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

/delivery/dispatch (Dispatch Page)
   â”‚
   â”œâ”€ Shows: All PACKED invoices without delivery sessions
   â”œâ”€ Action: "Start Delivery" button
   â””â”€ Opens: DeliveryModal

DeliveryModal (Component)
   â”‚
   â”œâ”€ Step 1: Select delivery type (3 options)
   â”œâ”€ Step 2: Counter Pickup â†’ Select sub-type
   â”œâ”€ Step 3: Show form based on selection
   â””â”€ Submit â†’ Creates delivery session

/delivery/courier-deliveries (Courier Consider List)
   â”‚
   â”œâ”€ Shows: delivery_type=COURIER, status=TO_CONSIDER
   â”œâ”€ Action: "Upload Slip" button
   â””â”€ On upload â†’ Marked as DELIVERED

/delivery/company-deliveries (Company Consider List)
   â”‚
   â”œâ”€ Shows: delivery_type=INTERNAL, status=TO_CONSIDER
   â”œâ”€ Action: View assigned staff
   â””â”€ Staff completes from their dashboard

/ops/delivery/my-deliveries (Staff Dashboard)
   â”‚
   â”œâ”€ Shows: Deliveries assigned to logged-in DELIVERY role user
   â”œâ”€ Action: Accept & Complete delivery
   â””â”€ On complete â†’ Marked as DELIVERED

/history (Delivery History)
   â”‚
   â”œâ”€ Shows: All completed deliveries
   â”œâ”€ Filter by: delivery_type, date range, status
   â””â”€ View: Complete delivery details & timeline
```

---

## Status Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STATUS TRANSITIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Counter Pickup (DIRECT):
  PENDING â†’ DELIVERED âœ…

Courier Delivery:
  PENDING â†’ TO_CONSIDER â†’ IN_TRANSIT â†’ DELIVERED âœ…

Company Delivery:
  PENDING â†’ TO_CONSIDER â†’ IN_TRANSIT â†’ DELIVERED âœ…

Cancelled:
  Any status â†’ CANCELLED âŒ
```

---

## Database Relationships

```
Invoice (1) â†â†’ (1) DeliverySession
   â†‘
   â”‚ References
   â†“
Customer, Salesman, Items

DeliverySession
   â”œâ”€ assigned_to â†’ User (who initiated)
   â”œâ”€ delivered_by â†’ User (who completed)
   â””â”€ invoice â†’ Invoice

User
   â”œâ”€ assigned_deliveries (as assigned_to)
   â”œâ”€ delivered_invoices (as delivered_by)
   â””â”€ created_invoices (as created_user)
```

---

## Key Differences Summary

| Feature | Counter Pickup | Courier Delivery | Company Delivery |
|---------|---------------|------------------|------------------|
| **Completion** | Instant | Multi-step | Multi-step |
| **Consider List** | No | Yes | Yes |
| **Staff Assignment** | No | No (courier assigned) | Yes |
| **File Upload** | No | Yes (slip) | No |
| **Final Status** | DELIVERED | DELIVERED | DELIVERED |
| **Invoice Status** | DELIVERED | PACKED â†’ DISPATCHED â†’ DELIVERED | PACKED â†’ DISPATCHED â†’ DELIVERED |
| **Dispatch Page** | âŒ Bypassed | âœ… Goes through | âœ… Goes through |

---

**Generated:** January 24, 2026
**Documentation:** DELIVERY_WORKFLOW_GUIDE.md
**Status:** âœ… Implementation Complete
